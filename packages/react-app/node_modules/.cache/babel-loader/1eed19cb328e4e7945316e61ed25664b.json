{"ast":null,"code":"var _jsxFileName = \"/Users/Hilmar/code/integrations/krystal/gelato-krystal/packages/react-app/src/pages/SubmitTask.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { ethers } from \"ethers\";\nimport { ViewCard, CardWrapper, Button } from \"../components\";\nimport { getVault, getUserProxy } from \"../services/stateReads\";\nimport { submitOrder } from \"../services/stateWrites\";\nimport { addresses } from \"@gelato-krystal/contracts\";\nimport { submitRefinanceMakerToMaker } from \"../services/payloadGeneration\";\nconst {\n  DAI,\n  USDC\n} = addresses;\n\nconst SubmitTask = ({\n  userAccount\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [inputs, setInputs] = useState({});\n  const [totalAmount, setTotalAmount] = useState();\n  const [intervalSeconds, setIntervalSeconds] = useState();\n\n  const inputsUpdates = async () => {\n    const userProxy = await getUserProxy(userAccount);\n    const vA = await getVault(userAccount, userProxy, \"ETH-A\");\n    const vAId = vA !== undefined ? vA.id : 0;\n    const vB = await getVault(userAccount, userProxy, \"ETH-B\");\n    const vBId = vB !== undefined ? vB.id : 0;\n    setInputs({ ...inputs,\n      vaultAId: vAId,\n      vaultBId: vBId,\n      defaultValue: 10\n    });\n  };\n\n  const handleTotalAmountChange = async event => {\n    const newValue = event.target.value;\n    setTotalAmount(newValue);\n  };\n\n  const handleIntervalSecondsChange = async event => {\n    const newValue = event.target.value;\n    setIntervalSeconds(newValue);\n  };\n\n  const submit = async () => {\n    if (totalAmount === 0) return;\n    if (intervalSeconds === 0) return;\n    if (parseInt(inputs.vaultAId) === 0) return;\n    const data = await submitRefinanceMakerToMaker(userAccount, ethers.utils.parseUnits(String(parseFloat(totalAmount) / 100), 18), ethers.utils.parseUnits(String(parseFloat(intervalSeconds) / 100), 18), inputs.vaultAId, inputs.vaultBId);\n    await submitOrder(user, DAI, USDC, delay, amountPerTrade, nTrades, minSlippage = 9001, maxSlippage = 9000, gasPriceCeil = 0);\n  };\n\n  useEffect(() => {\n    inputsUpdates();\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(CardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ViewCard, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    style: {\n      margin: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 11\n    }\n  }, \"Total Amount of DAI to sell for USDC\"), /*#__PURE__*/React.createElement(\"input\", {\n    style: {\n      maxWidth: \"80%\"\n    },\n    type: \"number\",\n    value: totalAmount,\n    onChange: handleTotalAmountChange,\n    defaultValue: inputs.defaultValue,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(ViewCard, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    style: {\n      margin: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 11\n    }\n  }, \"Interval between each trade (in seconds)\"), /*#__PURE__*/React.createElement(\"input\", {\n    style: {\n      maxWidth: \"80%\"\n    },\n    type: \"number\",\n    value: intervalSeconds,\n    onChange: handleIntervalSecondsChange,\n    defaultValue: inputs.defaultValue,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(ViewCard, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }\n  }, !loading && /*#__PURE__*/React.createElement(Button, {\n    onClick: async () => {\n      setLoading(true);\n\n      try {\n        await submit();\n        setLoading(false);\n      } catch {\n        setLoading(false);\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }\n  }, \"Submit Task\"), loading && /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 23\n    }\n  }, \"waiting...\"))));\n};\n\nexport default SubmitTask;","map":{"version":3,"sources":["/Users/Hilmar/code/integrations/krystal/gelato-krystal/packages/react-app/src/pages/SubmitTask.js"],"names":["React","useState","useEffect","ethers","ViewCard","CardWrapper","Button","getVault","getUserProxy","submitOrder","addresses","submitRefinanceMakerToMaker","DAI","USDC","SubmitTask","userAccount","loading","setLoading","inputs","setInputs","totalAmount","setTotalAmount","intervalSeconds","setIntervalSeconds","inputsUpdates","userProxy","vA","vAId","undefined","id","vB","vBId","vaultAId","vaultBId","defaultValue","handleTotalAmountChange","event","newValue","target","value","handleIntervalSecondsChange","submit","parseInt","data","utils","parseUnits","String","parseFloat","user","delay","amountPerTrade","nTrades","minSlippage","maxSlippage","gasPriceCeil","margin","maxWidth"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { ethers } from \"ethers\";\nimport { ViewCard, CardWrapper, Button } from \"../components\";\nimport { getVault, getUserProxy } from \"../services/stateReads\";\nimport { submitOrder } from \"../services/stateWrites\";\nimport { addresses } from \"@gelato-krystal/contracts\";\nimport { submitRefinanceMakerToMaker } from \"../services/payloadGeneration\";\nconst { DAI, USDC } = addresses;\n\nconst SubmitTask = ({ userAccount }) => {\n  const [loading, setLoading] = useState(false);\n  const [inputs, setInputs] = useState({});\n  const [totalAmount, setTotalAmount] = useState();\n  const [intervalSeconds, setIntervalSeconds] = useState();\n\n  const inputsUpdates = async () => {\n    const userProxy = await getUserProxy(userAccount);\n    const vA = await getVault(userAccount, userProxy, \"ETH-A\");\n    const vAId = vA !== undefined ? vA.id : 0;\n    const vB = await getVault(userAccount, userProxy, \"ETH-B\");\n    const vBId = vB !== undefined ? vB.id : 0;\n\n    setInputs({\n      ...inputs,\n      vaultAId: vAId,\n      vaultBId: vBId,\n      defaultValue: 10,\n    });\n  };\n\n  const handleTotalAmountChange = async (event) => {\n    const newValue = event.target.value;\n    setTotalAmount(newValue);\n  };\n\n  const handleIntervalSecondsChange = async (event) => {\n    const newValue = event.target.value;\n    setIntervalSeconds(newValue);\n  };\n\n  const submit = async () => {\n    if (totalAmount === 0) return;\n    if (intervalSeconds === 0) return;\n    if (parseInt(inputs.vaultAId) === 0) return;\n\n    const data = await submitRefinanceMakerToMaker(\n      userAccount,\n      ethers.utils.parseUnits(String(parseFloat(totalAmount) / 100), 18),\n      ethers.utils.parseUnits(String(parseFloat(intervalSeconds) / 100), 18),\n      inputs.vaultAId,\n      inputs.vaultBId\n    );\n\n    await submitOrder(\n      user,\n      DAI,\n      USDC,\n      delay,\n      amountPerTrade,\n      nTrades,\n      (minSlippage = 9001),\n      (maxSlippage = 9000),\n      (gasPriceCeil = 0)\n    );\n  };\n\n  useEffect(() => {\n    inputsUpdates();\n  });\n\n  return (\n    <>\n      <CardWrapper>\n        <ViewCard>\n          <label style={{ margin: \"10px\" }}>\n            Total Amount of DAI to sell for USDC\n          </label>\n\n          <input\n            style={{ maxWidth: \"80%\" }}\n            type=\"number\"\n            value={totalAmount}\n            onChange={handleTotalAmountChange}\n            defaultValue={inputs.defaultValue}\n          />\n        </ViewCard>\n\n        <ViewCard>\n          <label style={{ margin: \"10px\" }}>\n            Interval between each trade (in seconds)\n          </label>\n\n          <input\n            style={{ maxWidth: \"80%\" }}\n            type=\"number\"\n            value={intervalSeconds}\n            onChange={handleIntervalSecondsChange}\n            defaultValue={inputs.defaultValue}\n          />\n        </ViewCard>\n\n        <ViewCard>\n          {!loading && (\n            <Button\n              onClick={async () => {\n                setLoading(true);\n                try {\n                  await submit();\n                  setLoading(false);\n                } catch {\n                  setLoading(false);\n                }\n              }}\n            >\n              Submit Task\n            </Button>\n          )}\n          {loading && <p>waiting...</p>}\n        </ViewCard>\n      </CardWrapper>\n    </>\n  );\n};\n\nexport default SubmitTask;\n"]},"metadata":{},"sourceType":"module"}