{"ast":null,"code":"var _jsxFileName = \"/Users/Hilmar/code/integrations/krystal/gelato-krystal/packages/react-app/src/pages/User.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { ethers } from \"ethers\";\nimport { CardWrapper } from \"../components\";\nimport InputCard from \"../components/InputCard\";\nimport ViewCardWrapper from \"../components/ViewCardWrapper\";\nimport ViewCardButton from \"../components/ViewCardButton\";\nimport { getMiniUserAddress, getUserProxy, userHaveETHAVault, userHaveETHBVault, getVault, gelatoIsAuth, getTokenBalance, getETHAVaultDebt, getETHAVaultCols } from \"../services/stateReads\";\nimport { getMiniAddress, getFormattedNumber } from \"../utils/helpers\";\nimport { userProxyCast } from \"../services/stateWrites\";\nimport { addresses } from \"@project/contracts\";\nimport { openMakerVault, depositMakerVault, borrowMakerVault, authorizeGelato } from \"../services/payloadGeneration\";\nconst {\n  CONNECT_MAKER_ADDR,\n  CONNECT_AUTH,\n  DAI\n} = addresses;\n\nconst User = ({\n  userAccount\n}) => {\n  const [inputs, setInputs] = useState({});\n  const [refresh, setRefresh] = useState(false);\n\n  const inputsUpdates = async () => {\n    const miniUserAddress = await updateUserAddress();\n    const userProxyAddress = await updateDsProxyAddress();\n    const userProxy = await getUserProxy(userAccount);\n    const userProxyHasVaultA = await userHaveETHAVault(userAccount, userProxy);\n    const userProxyHasVaultB = await userHaveETHBVault(userAccount, userProxy);\n    const gelatoHasRight = await gelatoIsAuth(userAccount);\n    const vaultADebt = await getFormattedNumber(await getETHAVaultDebt(userAccount, userProxy));\n    const vaultALockedCol = await getFormattedNumber(await getETHAVaultCols(userAccount, userProxy));\n    const proxyDAIBalance = await getFormattedNumber(await getTokenBalance(userAccount, DAI));\n    setInputs({ ...inputs,\n      dsProxyAddress: userProxyAddress,\n      userAddress: miniUserAddress,\n      vaultAExist: userProxyHasVaultA,\n      vaultBExist: userProxyHasVaultB,\n      gelatoHasRight: gelatoHasRight,\n      dsProxyBalance: proxyDAIBalance,\n      dsProxyDebt: vaultADebt,\n      dsProxyLockCol: vaultALockedCol,\n      userProxy: userProxy\n    });\n  };\n\n  const updateDsProxyAddress = async () => {\n    return getMiniAddress(await getUserProxy(userAccount));\n  };\n\n  const updateUserAddress = async () => {\n    return await getMiniUserAddress(userAccount);\n  };\n\n  const openVaultA = async () => {\n    if (await userHaveETHAVault(userAccount, inputs.userProxy)) return;\n    await userProxyCast([CONNECT_MAKER_ADDR], [await openMakerVault(\"ETH-A\")], userAccount, 0, 500000);\n    setInputs({ ...inputs,\n      vaultAExist: true\n    });\n    setRefresh(!refresh);\n  };\n\n  const openVaultB = async () => {\n    if (await userHaveETHBVault(userAccount, inputs.userProxy)) return;\n    await userProxyCast([CONNECT_MAKER_ADDR], [await openMakerVault(\"ETH-B\")], userAccount, 0, 500000);\n    setInputs({ ...inputs,\n      vaultBExist: true\n    });\n    setRefresh(!refresh);\n  };\n\n  const depositVaultA = async newValue => {\n    const deposit = newValue;\n    const vault = await getVault(userAccount, inputs.userProxy, \"ETH-A\");\n    const vaultId = vault !== undefined ? vault.id : 0;\n    const valueOfDeposit = ethers.utils.parseEther(String(deposit));\n    const data = await depositMakerVault(valueOfDeposit, vaultId);\n    await userProxyCast([CONNECT_MAKER_ADDR], [data], userAccount, valueOfDeposit, 500000);\n    setRefresh(!refresh);\n  };\n\n  const borrowVaultA = async newValue => {\n    const borrow = newValue;\n    const vault = await getVault(userAccount, inputs.userProxy, \"ETH-A\");\n    const vaultId = vault !== undefined ? vault.id : 0;\n    const data = await borrowMakerVault(ethers.utils.parseEther(borrow), vaultId);\n    await userProxyCast([CONNECT_MAKER_ADDR], [data], userAccount, 0, 500000);\n    setRefresh(!refresh);\n  };\n\n  const setGelatoAsAuthority = async () => {\n    await userProxyCast([CONNECT_AUTH], [await authorizeGelato()], userAccount, 0, 500000);\n    setInputs({ ...inputs,\n      gelatoHasRight: true\n    });\n    setRefresh(!refresh);\n  };\n\n  useEffect(() => {\n    inputsUpdates();\n  }, [refresh]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, !inputs.gelatoHasRight && /*#__PURE__*/React.createElement(CardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ViewCardButton, {\n    title: \"Authorize Gelato\",\n    action: setGelatoAsAuthority,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(CardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ViewCardWrapper, {\n    title: \"User Address\",\n    state: inputs.userAddress,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(ViewCardWrapper, {\n    title: \"DSA Address\",\n    state: inputs.dsProxyAddress,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(CardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ViewCardWrapper, {\n    title: \"DSA Maker Vault A Debt\",\n    state: inputs.dsProxyDebt,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(ViewCardWrapper, {\n    title: \"DSA Maker Vault A Locked Col\",\n    state: inputs.dsProxyLockCol,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(ViewCardWrapper, {\n    title: \"DSA DAI Token Balance\",\n    state: inputs.dsProxyBalance,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(CardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }\n  }, !inputs.vaultAExist && /*#__PURE__*/React.createElement(ViewCardButton, {\n    title: \"Create ETH-A Vault\",\n    action: openVaultA,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 11\n    }\n  }), inputs.vaultAExist && /*#__PURE__*/React.createElement(InputCard, {\n    title: \"Deposit Col in ETH-A Vault\",\n    btnText: \"Deposit\",\n    setInputs: setInputs,\n    inputs: inputs,\n    execFunc: depositVaultA,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 11\n    }\n  }), inputs.vaultAExist && /*#__PURE__*/React.createElement(InputCard, {\n    title: \"Borrow DAI from ETH-A Vault\",\n    btnText: \"Borrow\",\n    setInputs: setInputs,\n    inputs: inputs,\n    execFunc: borrowVaultA,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 11\n    }\n  })), !inputs.vaultBExist && /*#__PURE__*/React.createElement(CardWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ViewCardButton, {\n    title: \"Create ETH-B Vault\",\n    action: openVaultB,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 11\n    }\n  })));\n};\n\nexport default User;","map":{"version":3,"sources":["/Users/Hilmar/code/integrations/krystal/gelato-krystal/packages/react-app/src/pages/User.js"],"names":["React","useState","useEffect","ethers","CardWrapper","InputCard","ViewCardWrapper","ViewCardButton","getMiniUserAddress","getUserProxy","userHaveETHAVault","userHaveETHBVault","getVault","gelatoIsAuth","getTokenBalance","getETHAVaultDebt","getETHAVaultCols","getMiniAddress","getFormattedNumber","userProxyCast","addresses","openMakerVault","depositMakerVault","borrowMakerVault","authorizeGelato","CONNECT_MAKER_ADDR","CONNECT_AUTH","DAI","User","userAccount","inputs","setInputs","refresh","setRefresh","inputsUpdates","miniUserAddress","updateUserAddress","userProxyAddress","updateDsProxyAddress","userProxy","userProxyHasVaultA","userProxyHasVaultB","gelatoHasRight","vaultADebt","vaultALockedCol","proxyDAIBalance","dsProxyAddress","userAddress","vaultAExist","vaultBExist","dsProxyBalance","dsProxyDebt","dsProxyLockCol","openVaultA","openVaultB","depositVaultA","newValue","deposit","vault","vaultId","undefined","id","valueOfDeposit","utils","parseEther","String","data","borrowVaultA","borrow","setGelatoAsAuthority"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { ethers } from \"ethers\";\nimport { CardWrapper } from \"../components\";\nimport InputCard from \"../components/InputCard\";\nimport ViewCardWrapper from \"../components/ViewCardWrapper\";\nimport ViewCardButton from \"../components/ViewCardButton\";\nimport {\n  getMiniUserAddress,\n  getUserProxy,\n  userHaveETHAVault,\n  userHaveETHBVault,\n  getVault,\n  gelatoIsAuth,\n  getTokenBalance,\n  getETHAVaultDebt,\n  getETHAVaultCols,\n} from \"../services/stateReads\";\nimport { getMiniAddress, getFormattedNumber } from \"../utils/helpers\";\nimport { userProxyCast } from \"../services/stateWrites\";\nimport { addresses } from \"@project/contracts\";\nimport {\n  openMakerVault,\n  depositMakerVault,\n  borrowMakerVault,\n  authorizeGelato,\n} from \"../services/payloadGeneration\";\nconst { CONNECT_MAKER_ADDR, CONNECT_AUTH, DAI } = addresses;\n\nconst User = ({ userAccount }) => {\n  const [inputs, setInputs] = useState({});\n  const [refresh, setRefresh] = useState(false);\n\n  const inputsUpdates = async () => {\n    const miniUserAddress = await updateUserAddress();\n    const userProxyAddress = await updateDsProxyAddress();\n    const userProxy = await getUserProxy(userAccount);\n    const userProxyHasVaultA = await userHaveETHAVault(userAccount, userProxy);\n    const userProxyHasVaultB = await userHaveETHBVault(userAccount, userProxy);\n    const gelatoHasRight = await gelatoIsAuth(userAccount);\n    const vaultADebt = await getFormattedNumber(\n      await getETHAVaultDebt(userAccount, userProxy)\n    );\n    const vaultALockedCol = await getFormattedNumber(\n      await getETHAVaultCols(userAccount, userProxy)\n    );\n    const proxyDAIBalance = await getFormattedNumber(\n      await getTokenBalance(userAccount, DAI)\n    );\n\n    setInputs({\n      ...inputs,\n      dsProxyAddress: userProxyAddress,\n      userAddress: miniUserAddress,\n      vaultAExist: userProxyHasVaultA,\n      vaultBExist: userProxyHasVaultB,\n      gelatoHasRight: gelatoHasRight,\n      dsProxyBalance: proxyDAIBalance,\n      dsProxyDebt: vaultADebt,\n      dsProxyLockCol: vaultALockedCol,\n      userProxy: userProxy,\n    });\n  };\n\n  const updateDsProxyAddress = async () => {\n    return getMiniAddress(await getUserProxy(userAccount));\n  };\n\n  const updateUserAddress = async () => {\n    return await getMiniUserAddress(userAccount);\n  };\n\n  const openVaultA = async () => {\n    if (await userHaveETHAVault(userAccount, inputs.userProxy)) return;\n\n    await userProxyCast(\n      [CONNECT_MAKER_ADDR],\n      [await openMakerVault(\"ETH-A\")],\n      userAccount,\n      0,\n      500000\n    );\n    setInputs({ ...inputs, vaultAExist: true });\n    setRefresh(!refresh);\n  };\n\n  const openVaultB = async () => {\n    if (await userHaveETHBVault(userAccount, inputs.userProxy)) return;\n\n    await userProxyCast(\n      [CONNECT_MAKER_ADDR],\n      [await openMakerVault(\"ETH-B\")],\n      userAccount,\n      0,\n      500000\n    );\n    setInputs({ ...inputs, vaultBExist: true });\n    setRefresh(!refresh);\n  };\n\n  const depositVaultA = async (newValue) => {\n    const deposit = newValue;\n\n    const vault = await getVault(userAccount, inputs.userProxy, \"ETH-A\");\n    const vaultId = vault !== undefined ? vault.id : 0;\n    const valueOfDeposit = ethers.utils.parseEther(String(deposit));\n    const data = await depositMakerVault(valueOfDeposit, vaultId);\n\n    await userProxyCast(\n      [CONNECT_MAKER_ADDR],\n      [data],\n      userAccount,\n      valueOfDeposit,\n      500000\n    );\n    setRefresh(!refresh);\n  };\n\n  const borrowVaultA = async (newValue) => {\n    const borrow = newValue;\n\n    const vault = await getVault(userAccount, inputs.userProxy, \"ETH-A\");\n    const vaultId = vault !== undefined ? vault.id : 0;\n    const data = await borrowMakerVault(\n      ethers.utils.parseEther(borrow),\n      vaultId\n    );\n\n    await userProxyCast([CONNECT_MAKER_ADDR], [data], userAccount, 0, 500000);\n    setRefresh(!refresh);\n  };\n\n  const setGelatoAsAuthority = async () => {\n    await userProxyCast(\n      [CONNECT_AUTH],\n      [await authorizeGelato()],\n      userAccount,\n      0,\n      500000\n    );\n\n    setInputs({ ...inputs, gelatoHasRight: true });\n    setRefresh(!refresh);\n  };\n\n  useEffect(() => {\n    inputsUpdates();\n  }, [refresh]);\n\n  return (\n    <>\n      {!inputs.gelatoHasRight && (\n        <CardWrapper>\n          <ViewCardButton\n            title=\"Authorize Gelato\"\n            action={setGelatoAsAuthority}\n          ></ViewCardButton>\n        </CardWrapper>\n      )}\n      <CardWrapper>\n        <ViewCardWrapper\n          title=\"User Address\"\n          state={inputs.userAddress}\n        ></ViewCardWrapper>\n        <ViewCardWrapper\n          title=\"DSA Address\"\n          state={inputs.dsProxyAddress}\n        ></ViewCardWrapper>\n      </CardWrapper>\n      <CardWrapper>\n        <ViewCardWrapper\n          title=\"DSA Maker Vault A Debt\"\n          state={inputs.dsProxyDebt}\n        ></ViewCardWrapper>\n        <ViewCardWrapper\n          title=\"DSA Maker Vault A Locked Col\"\n          state={inputs.dsProxyLockCol}\n        ></ViewCardWrapper>\n        <ViewCardWrapper\n          title=\"DSA DAI Token Balance\"\n          state={inputs.dsProxyBalance}\n        ></ViewCardWrapper>\n      </CardWrapper>\n      <CardWrapper>\n        {!inputs.vaultAExist && (\n          <ViewCardButton\n            title=\"Create ETH-A Vault\"\n            action={openVaultA}\n          ></ViewCardButton>\n        )}\n        {inputs.vaultAExist && (\n          <InputCard\n            title=\"Deposit Col in ETH-A Vault\"\n            btnText=\"Deposit\"\n            setInputs={setInputs}\n            inputs={inputs}\n            execFunc={depositVaultA}\n          ></InputCard>\n        )}\n        {inputs.vaultAExist && (\n          <InputCard\n            title=\"Borrow DAI from ETH-A Vault\"\n            btnText=\"Borrow\"\n            setInputs={setInputs}\n            inputs={inputs}\n            execFunc={borrowVaultA}\n          ></InputCard>\n        )}\n      </CardWrapper>\n      {!inputs.vaultBExist && (\n        <CardWrapper>\n          <ViewCardButton\n            title=\"Create ETH-B Vault\"\n            action={openVaultB}\n          ></ViewCardButton>\n        </CardWrapper>\n      )}\n    </>\n  );\n};\n\nexport default User;\n"]},"metadata":{},"sourceType":"module"}